# 项目: 单词服务器

本项目主要是介绍如何读取数据包。你需要从服务器(提供的)接收编码数据流，然后编写代码来确定何时收到了完整的数据包并打印出该数据。

## 综述

**准备工作** 下载这些文件:
* [fls[**`wordserver.py`**|word/wordserver.py]]: 一个可以随时运行分发随机单词列表的服务器。

* [fls[**`wordclient.py`**|word/wordclient.py]]: 客户端程序框架。

**限制条件！请不要更改下面任何已经存在的代码！** 只需要搜索`TODO`并填入代码，你可以按照你的需要增加变量和函数。

**要求！代码必须能够处理传给`recv()`的从`1`到`4096`之间任何正值！**你可以使用`1`, `5`, 和 `4096`来测试代码，确保它们都能正确工作。

**要求！代码必须能够处理长度1到长度65535的单词。** 该服务端程序不要求处理特别长的单词，不过你可以修改代码来进行测试。你可以使用如下方法来建立一个固定长度字母的Python字符串:

``` {.py}
long_str = "a" * 256   # Make a string of 256 "a"s
```

**高级技巧！在开始之前，阅读并理解所有现有的客户端代码。**这将是你免于陷入各种困境。请注意，代码的核心部分甚至不关心字节和流——它只关心整个数据包。简洁易懂，是不是？

你需要完成两个函数:
* **`get_next_word_packet()`**: 从数据流中返回下一个完整的单词数据包，注意，这里需要返回一个 _完整的数据包_, 包括数据头和数据本身。

* **`extract_word()`**: 从一个完整的单词数据包中提取并返回一个完整的单词。

除此之外，该程序还做什么？请继续往下看！

## 什么是“单词数据包？”

当你连接到服务器时，它将会给你发送一个数据流。该流由一个随机表示单词的长度的数(1到10)的前缀(以字节为单位)加上单词组成。每一个单词都是UTF-8编码。
单词长度被编码为一个大端字节序的2字节的数字。举例来说，长度为5的的单词"hello"被编码为如下字节流(十六进制表示):

``` {.default}
length 5
  |
+-+-+
|   | h  e  l  l  o
00 05 68 65 6C 6C 6F
```

和字母对应的数字都是字母的UTF-8编码。
> 有趣的事实: 对于英语字母表中的字母和数字，UTF-8, ASCII, 和ISO-8859-1编码都是一样的。

单词"hi"和"encyclopedia"会被编码成两单词的数据包，其在数据流中进行传输，如下所示:

``` {.default}
length 2   length 12
  |           |
+-+-+       +-+-+
|   | h  i  |   | e  n  c  y  c  l  o  p  e  d  i  a
00 02 68 69 00 0C 65 6E 63 79 63 6C 6F 70 65 64 69 61
```

## 实现: `get_next_word_packet()`

本函数以已经连接的套接字作为参数，将返回下一个单词数据包（单词长度加上单词本身，和所收到的一样）作为一个字节字符串。其从字节流中解析数据包的过程主要和[解析数据包](#parsing-packets)的框架大体一致。

举例来说，如果收到的单词是上面例子中的"hi"和"encyclopedia"，当我们接收到开头的5字节之后，字节缓冲区将会包含:

``` {.default}
      h  i  
00 02 68 69 00
```

我们看到开头的单词是2字节，并且我们已经获取了这2字节。接着，我们将会解析并且返回第一个单词("hi")和它的长度（字节`00` `02`），最终返回的字节字符串为:

``` {.default}
      h  i
00 02 68 69
```

我们还会将这些字节从数据包缓冲区中剥离出来，这样就只剩下最后的0了。

``` {.default}
00
```

在此刻，缓冲区中已经没有完整的单词了，随后对该函数的调用将为下一个数据块触发`recv(5)`,我们将会得到:

``` {.default}
      e  n  c  y
00 0C 65 6E 63 79
```

如此反复。

## 实现: `extract_word()`

本函数接收一个完整的单词数据包作为输入，例如:

``` {.default}
      h  i
00 02 68 69
```

而返回该单词的字符串，`"hi"`，此过程获取单词长度并且返回正确的单词字节。

不过请注意:获取的单词都是UTF-8编码的！所以你需要调用`.decode()`来将其转换为字符串（默认编码是UTF-8，所以你不需要向`.decode()`传递任何函数。）

<!-- 评分表
55 分

-10 代码框架中不需要修改的地方一字未改
-5 函数Recv只用5作为参数进行调用
-15 函数get_next_word_packet()仅仅以字节字符串的形式返回下一个完整的数据包
-5 函数get_next_word_packet()正确的从全局缓冲区中删除了完整的第一个数据包
-5 函数get_next_word_packet()在服务器关闭连接时返回None
-5 函数extract_word()从数据包中提取出单词
-10 函数extract_word()以UTF-8编码字符串的形式返回单词

-->
